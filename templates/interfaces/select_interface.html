{% extends "base.html" %}
{% load static %}

{% block title %}Schnittstelle für Bestellung {{ order.order_number }} auswählen{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1>Schnittstelle für Bestellung auswählen</h1>
                <a href="{% url 'purchase_order_detail' pk=order.id %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Zurück zur Bestellung
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Bestellinformationen</h5>
                </div>
                <div class="card-body">
                    <p><strong>Bestellnummer:</strong> {{ order.order_number }}</p>
                    <p><strong>Lieferant:</strong> {{ order.supplier.name }}</p>
                    <p><strong>Bestelldatum:</strong> {{ order.order_date|date:"d.m.Y" }}</p>
                    <p><strong>Status:</strong> <span class="badge bg-info">{{ order.get_status_display }}</span></p>
                    <p><strong>Gesamtwert:</strong> {{ order.total|floatformat:2 }} €</p>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Verfügbare Schnittstellen</h5>
                </div>
                <div class="card-body">
                    {% if interfaces %}
                        <p>Wählen Sie eine der verfügbaren Schnittstellen aus, um die Bestellung an {{ order.supplier.name }} zu senden:</p>
                        
                        <form method="post" action="{% url 'select_interface' order_id=order.id %}">
                            {% csrf_token %}
                            
                            <div class="list-group mb-4">
                                {% for interface in interfaces %}
                                    <label class="list-group-item list-group-item-action">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <input type="radio" name="interface" value="{{ interface.id }}" class="form-check-input me-3" 
                                                       {% if interface.is_default %}checked{% endif %}>
                                                <strong>{{ interface.name }}</strong>
                                                {% if interface.is_default %}
                                                    <span class="badge bg-primary ms-2">Standard</span>
                                                {% endif %}
                                                
                                                <div class="small text-muted ms-4 mt-1">
                                                    <i class="{% if interface.interface_type.code == 'email' %}fas fa-envelope
                                                              {% elif interface.interface_type.code == 'api' %}fas fa-cloud
                                                              {% elif interface.interface_type.code == 'ftp' %}fas fa-server
                                                              {% elif interface.interface_type.code == 'sftp' %}fas fa-lock
                                                              {% else %}fas fa-exchange-alt{% endif %} me-1"></i>
                                                    Typ: {{ interface.interface_type.name }}
                                                    
                                                    {% if interface.interface_type.code == 'email' %}
                                                        <span class="ms-3">Empfänger: {{ interface.email_to|truncatechars:30 }}</span>
                                                    {% elif interface.interface_type.code == 'api' %}
                                                        <span class="ms-3">API-URL: {{ interface.api_url|truncatechars:30 }}</span>
                                                    {% elif interface.interface_type.code == 'ftp' or interface.interface_type.code == 'sftp' %}
                                                        <span class="ms-3">Host: {{ interface.host }}</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <a href="{% url 'interface_detail' pk=interface.id %}" class="btn btn-sm btn-outline-secondary">
                                                <i class="bi bi-info-circle"></i>
                                            </a>
                                        </div>
                                    </label>
                                {% endfor %}
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <a href="{% url 'purchase_order_detail' pk=order.id %}" class="btn btn-secondary">
                                    Abbrechen
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-2"></i> Bestellung senden
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Es sind keine aktiven Schnittstellen für den Lieferanten {{ order.supplier.name }} konfiguriert.
                        </div>
                        
                        <div class="mt-4">
                            <p>Um Bestellungen an diesen Lieferanten senden zu können, müssen Sie zuerst eine Schnittstelle konfigurieren:</p>
                            <a href="{% url 'interface_create' %}?supplier={{ order.supplier.id }}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i> Schnittstelle für {{ order.supplier.name }} erstellen
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}